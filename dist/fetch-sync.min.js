!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.fetchSync=t():e.fetchSync=t()}(this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.i=function(e){return e},t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=17)}([function(e,t,n){"use strict";function r(){p=!1}function o(e){if(!e)return void(f!==d&&(f=d,r()));if(e!==f){if(e.length!==d.length)throw new Error("Custom alphabet for shortid must be "+d.length+" unique characters. You submitted "+e.length+" characters: "+e);var t=e.split("").filter(function(e,t,n){return t!==n.lastIndexOf(e)});if(t.length)throw new Error("Custom alphabet for shortid must be "+d.length+" unique characters. These characters were not unique: "+t.join(", "));f=e,r()}}function i(e){return o(e),f}function s(e){h.seed(e),l!==e&&(r(),l=e)}function u(){f||o(d);for(var e,t=f.split(""),n=[],r=h.nextValue();t.length>0;)r=h.nextValue(),e=Math.floor(r*t.length),n.push(t.splice(e,1)[0]);return n.join("")}function a(){return p||(p=u())}function c(e){return a()[e]}var f,l,p,h=n(12),d="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_-";e.exports={characters:i,seed:s,lookup:c,shuffled:a}},function(e,t,n){"use strict";function r(e,t){for(var n,r=0,i="";!n;)i+=e(t>>4*r&15|o()),n=t<Math.pow(16,r+1),r++;return i}var o=n(11);e.exports=r},function(e,t,n){"use strict";e.exports=n(9)},function(e,t,n){"use strict";function r(e,t){return new o(e,t)}function o(e,t){this.handlers=e,this.isClient=Boolean(t),this.isWorker=!this.isClient,this.open=u(),this.receiveHandlers=[],this.promises={},this.isClient?(this.open.resolve(),this.recipient=t,this.messageChannel=new c,this.messageChannel.port1.onmessage=this._handleMessage.bind(this),this.send(r.types.CONNECT)):a.onmessage=this._handleMessage.bind(this)}var i,s=n(2),u=n(6);try{var a=self,c=MessageChannel}catch(e){}r.worker=function(e){return r(e,null)},r.client=function(e,t,n){return a=n?{}:self,c=n||MessageChannel,r(t,e)},r.types={CONNECT:"@@MSGR/CONNECT",UNKNOWN:"@@MSGR/UNKNOWN",RESPONSE:"@@MSGR/RESPONSE"},o.prototype._handleMessage=function(e){try{var t=JSON.parse(e.data),n=t.id,o=t.type;if(!n||!o)throw new Error}catch(e){throw new Error("msgr: malformed message")}var i=function(e){this.send(r.types.RESPONSE,e,n)}.bind(this);if(this.isWorker&&t.data===r.types.CONNECT&&(this.recipient=e.ports[0],this.open.resolve()),t.type===r.types.UNKNOWN&&t.data in this.handlers)this.handlers[t.data](null,i);else if(t.type in this.handlers)this.handlers[t.type](t.data,i);else if(n&&n in this.promises){var s=this.promises[n];s.resolve(t.data),this.promises[n]=null}else this.receiveHandlers.forEach(function(e){e(t.data,i)})},o.prototype.ready=function(e){this.open.promise.then(e)},o.prototype.receive=function(e){if("function"!=typeof e)throw new Error("msgr: expecting handler to be a function");this.receiveHandlers.push(e)},o.prototype.send=function(e,t,n){var o=n||s.generate();t||(t=e,e!==r.types.RESPONSE&&(e=r.types.UNKNOWN));var i=u(),a=JSON.stringify({__msgr:!0,id:o,type:e,data:t}),c=[a];return this.isClient&&t===r.types.CONNECT&&c.push([this.messageChannel.port2]),this.open.promise.then(function(){this.recipient.postMessage.apply(this.recipient,c)}.bind(this)),this.promises[o]=i,i.promise};var f={client:r.client,worker:r.worker,types:r.types};void 0!==(i=function(){return f}.call(t,n,t,e))&&(e.exports=i)},function(e,t,n){!function(t,n){e.exports=n()}(0,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={exports:{},id:r,loaded:!1};return e[r].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){function r(e){return a.blobToArrayBuffer(e).then(function(e){return String.fromCharCode.apply(null,new Uint16Array(e))})}function o(e,t){return a.base64StringToBlob(e).then(function(e){switch(t){case c.ARRAY_BUFFER:return a.blobToArrayBuffer(e);case c.BLOB:return e;case c.FORM_DATA:throw new Error("Cannot make FormData from serialised Request");case c.JSON:return r(e).then(function(e){return JSON.parse(e)});case c.TEXT:return r(e);default:throw new Error('Unknown requested body type "'+t+'"')}})}function i(e,t){if(!(e instanceof Request))throw new Error("Expecting request to be instance of Request");for(var n=[],r=e.headers.keys(),o=0;o<r.length;o++){var i=r[o];n[i]=e.headers.get(i)}var s={method:e.method,url:e.url,headers:n,context:e.context,referrer:e.referrer,mode:e.mode,credentials:e.credentials,redirect:e.redirect,integrity:e.integrity,cache:e.cache,bodyUsed:e.bodyUsed};return e.blob().then(a.blobToBase64String).then(function(e){return s.__body=e,t?s:JSON.stringify(s)})}function s(e){var t,n;if("string"==typeof e)t=JSON.parse(e),n=t.url;else{if("object"!=typeof e)throw new Error("Expecting serialised request to be a string or object");t=e,n=t.url}const r=new Request(n,t),i={context:{enumerable:!0,value:t.context}},s=Object.keys(c).reduce(function(e,n){return e[f[n]]={enumerable:!0,value:function(){return r.bodyUsed?Promise.reject(new TypeError("Already used")):(r.bodyUsed=!0,Promise.resolve(o(t.__body,n)))}},e},i);return Object.defineProperties(r,s),r}var u,u,a=n(1),c={ARRAY_BUFFER:"ARRAY_BUFFER",BLOB:"BLOB",FORM_DATA:"FORM_DATA",JSON:"JSON",TEXT:"TEXT"},f={ARRAY_BUFFER:"arrayBuffer",BLOB:"blob",FORM_DATA:"formData",JSON:"json",TEXT:"text"};i.deserialise=s,i.deserialize=s,u=function(){return i}.call(t,n,t,e),void 0!==u&&(e.exports=u),void 0!==(u=function(){return i}.call(t,n,t,e))&&(e.exports=u)},function(e,t,n){"use strict";function r(e){for(var t=e.length,n=new ArrayBuffer(t),r=new Uint8Array(n),o=-1;++o<t;)r[o]=e.charCodeAt(o);return n}function o(e){for(var t="",n=new Uint8Array(e),r=n.byteLength,o=-1;++o<r;)t+=String.fromCharCode(n[o]);return t}function i(e,t){return new E(function(n,r){var o=new Image;t&&(o.crossOrigin=t),o.onload=function(){n(o)},o.onerror=r,o.src=e})}function s(e){var t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,e.width,e.height),t}function u(e,t){return t=t||{},"string"==typeof t&&(t={type:t}),new g(e,t)}function a(e){return(window.URL||window.webkitURL).createObjectURL(e)}function c(e){return(window.URL||window.webkitURL).revokeObjectURL(e)}function f(e){return new E(function(t,n){var r=new FileReader,i="function"==typeof r.readAsBinaryString;r.onloadend=function(e){var n=e.target.result||"";return i?t(n):void t(o(n))},r.onerror=n,i?r.readAsBinaryString(e):r.readAsArrayBuffer(e)})}function l(e,t){return E.resolve().then(function(){var n=[r(atob(e))];return t?u(n,{type:t}):u(n)})}function p(e,t){return E.resolve().then(function(){return l(btoa(e),t)})}function h(e){return f(e).then(function(e){return btoa(e)})}function d(e){return E.resolve().then(function(){var t=e.match(/data:([^;]+)/)[1],n=e.replace(/^[^,]+,/,"");return u([r(atob(n))],{type:t})})}function v(e,t,n,r){return t=t||"image/png",i(e,n).then(function(e){return s(e)}).then(function(e){return e.toDataURL(t,r)})}function y(e,t,n){return E.resolve().then(function(){return"function"==typeof e.toBlob?new E(function(r){e.toBlob(r,t,n)}):d(e.toDataURL(t,n))})}function w(e,t,n,r){return t=t||"image/png",i(e,n).then(function(e){return s(e)}).then(function(e){return y(e,t,r)})}function m(e,t){return E.resolve().then(function(){return u([e],t)})}function b(e){return new E(function(t,n){var r=new FileReader;r.onloadend=function(e){var n=e.target.result||new ArrayBuffer(0);t(n)},r.onerror=n,r.readAsArrayBuffer(e)})}var g=n(2),E=n(3);e.exports={createBlob:u,createObjectURL:a,revokeObjectURL:c,imgSrcToBlob:w,imgSrcToDataURL:v,canvasToBlob:y,dataURLToBlob:d,blobToBase64String:h,base64StringToBlob:l,binaryStringToBlob:p,blobToBinaryString:f,arrayBufferToBlob:m,blobToArrayBuffer:b}},function(e,t){(function(t){function n(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.buffer instanceof ArrayBuffer){var r=n.buffer;if(n.byteLength!==r.byteLength){var o=new Uint8Array(n.byteLength);o.set(new Uint8Array(r,n.byteOffset,n.byteLength)),r=o.buffer}e[t]=r}}}function r(e,t){t=t||{};var r=new i;n(e);for(var o=0;o<e.length;o++)r.append(e[o]);return t.type?r.getBlob(t.type):r.getBlob()}function o(e,t){return n(e),new Blob(e,t||{})}var i=t.BlobBuilder||t.WebKitBlobBuilder||t.MSBlobBuilder||t.MozBlobBuilder,s=function(){try{return 2===new Blob(["hi"]).size}catch(e){return!1}}(),u=s&&function(){try{return 2===new Blob([new Uint8Array([1,2])]).size}catch(e){return!1}}(),a=i&&i.prototype.append&&i.prototype.getBlob;e.exports=function(){return s?u?t.Blob:o:a?r:void 0}()}).call(t,function(){return this}())},function(e,t,n){(function(t){"function"==typeof t.Promise?e.exports=t.Promise:e.exports=n(4)}).call(t,function(){return this}())},function(e,t,n){var r,r;!function(t){e.exports=function(){return function e(t,n,o){function i(u,a){if(!n[u]){if(!t[u]){var c="function"==typeof r&&r;if(!a&&c)return r(u,!0);if(s)return s(u,!0);throw new Error("Cannot find module '"+u+"'")}var f=n[u]={exports:{}};t[u][0].call(f.exports,function(e){var n=t[u][1][e];return i(n||e)},f,f.exports,e,t,n,o)}return n[u].exports}for(var s="function"==typeof r&&r,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(e,t,n){"use strict";function r(){}t.exports=r},{}],2:[function(e,t,n){"use strict";var r=e("./promise"),o=e("./reject"),i=e("./resolve"),s=e("./INTERNAL"),u=e("./handlers"),a=o(new TypeError("must be an array"));t.exports=function(e){if("[object Array]"!==Object.prototype.toString.call(e))return a;var t=e.length,n=!1;if(!t)return i([]);for(var o=new Array(t),c=0,f=-1,l=new r(s);++f<t;)!function(e,r){function s(e){o[r]=e,++c===t&!n&&(n=!0,u.resolve(l,o))}i(e).then(s,function(e){n||(n=!0,u.reject(l,e))})}(e[f],f);return l}},{"./INTERNAL":1,"./handlers":3,"./promise":5,"./reject":7,"./resolve":8}],3:[function(e,t,n){"use strict";function r(e){var t=e&&e.then;return e&&"object"==typeof e&&"function"==typeof t?function(){t.apply(e,arguments)}:void 0}var o=e("./tryCatch"),i=e("./resolveThenable"),s=e("./states");n.resolve=function(e,t){var u=o(r,t);if("error"===u.status)return n.reject(e,u.value);var a=u.value;if(a)i.safely(e,a);else{e.state=s.FULFILLED,e.outcome=t;for(var c=-1,f=e.queue.length;++c<f;)e.queue[c].callFulfilled(t)}return e},n.reject=function(e,t){e.state=s.REJECTED,e.outcome=t;for(var n=-1,r=e.queue.length;++n<r;)e.queue[n].callRejected(t);return e}},{"./resolveThenable":9,"./states":10,"./tryCatch":11}],4:[function(e,t,n){t.exports=n=e("./promise"),n.resolve=e("./resolve"),n.reject=e("./reject"),n.all=e("./all")},{"./all":2,"./promise":5,"./reject":7,"./resolve":8}],5:[function(e,t,n){"use strict";function r(e){if(!(this instanceof r))return new r(e);if("function"!=typeof e)throw new TypeError("reslover must be a function");this.state=u.PENDING,this.queue=[],this.outcome=void 0,e!==i&&s.safely(this,e)}var o=e("./unwrap"),i=e("./INTERNAL"),s=e("./resolveThenable"),u=e("./states"),a=e("./queueItem");t.exports=r,r.prototype.catch=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if("function"!=typeof e&&this.state===u.FULFILLED||"function"!=typeof t&&this.state===u.REJECTED)return this;var n=new r(i);if(this.state!==u.PENDING){var s=this.state===u.FULFILLED?e:t;o(n,s,this.outcome)}else this.queue.push(new a(n,e,t));return n}},{"./INTERNAL":1,"./queueItem":6,"./resolveThenable":9,"./states":10,"./unwrap":12}],6:[function(e,t,n){"use strict";function r(e,t,n){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}var o=e("./handlers"),i=e("./unwrap");t.exports=r,r.prototype.callFulfilled=function(e){o.resolve(this.promise,e)},r.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},r.prototype.callRejected=function(e){o.reject(this.promise,e)},r.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)}},{"./handlers":3,"./unwrap":12}],7:[function(e,t,n){"use strict";function r(e){var t=new o(i);return s.reject(t,e)}var o=e("./promise"),i=e("./INTERNAL"),s=e("./handlers");t.exports=r},{"./INTERNAL":1,"./handlers":3,"./promise":5}],8:[function(e,t,n){"use strict";function r(e){if(e)return e instanceof o?e:s.resolve(new o(i),e);switch(typeof e){case"boolean":return u;case"undefined":return c;case"object":return a;case"number":return f;case"string":return l}}var o=e("./promise"),i=e("./INTERNAL"),s=e("./handlers");t.exports=r;var u=s.resolve(new o(i),!1),a=s.resolve(new o(i),null),c=s.resolve(new o(i),void 0),f=s.resolve(new o(i),0),l=s.resolve(new o(i),"")},{"./INTERNAL":1,"./handlers":3,"./promise":5}],9:[function(e,t,n){"use strict";function r(e,t){function n(t){u||(u=!0,o.reject(e,t))}function r(t){u||(u=!0,o.resolve(e,t))}function s(){t(r,n)}var u=!1,a=i(s);"error"===a.status&&n(a.value)}var o=e("./handlers"),i=e("./tryCatch");n.safely=r},{"./handlers":3,"./tryCatch":11}],10:[function(e,t,n){n.REJECTED=["REJECTED"],n.FULFILLED=["FULFILLED"],n.PENDING=["PENDING"]},{}],11:[function(e,t,n){"use strict";function r(e,t){var n={};try{n.value=e(t),n.status="success"}catch(e){n.status="error",n.value=e}return n}t.exports=r},{}],12:[function(e,t,n){"use strict";function r(e,t,n){o(function(){var r;try{r=t(n)}catch(t){return i.reject(e,t)}r===e?i.reject(e,new TypeError("Cannot resolve promise with itself")):i.resolve(e,r)})}var o=e("immediate"),i=e("./handlers");t.exports=r},{"./handlers":3,immediate:13}],13:[function(e,t,n){"use strict";function r(){i=!0;for(var e,t,n=a.length;n;){for(t=a,a=[],e=-1;++e<n;)t[e]();n=a.length}i=!1}function o(e){1!==a.push(e)||i||s()}for(var i,s,u=[e("./nextTick"),e("./messageChannel"),e("./stateChange"),e("./timeout")],a=[],c=-1,f=u.length;++c<f;)if(u[c].test()){s=u[c].install(r);break}t.exports=o},{"./messageChannel":14,"./nextTick":15,"./stateChange":16,"./timeout":17}],14:[function(e,t,n){(function(e){"use strict";n.test=function(){return!e.setImmediate&&void 0!==e.MessageChannel},n.install=function(t){var n=new e.MessageChannel;return n.port1.onmessage=t,function(){n.port2.postMessage(0)}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],15:[function(e,t,n){(function(e){"use strict";var t=e.MutationObserver||e.WebKitMutationObserver;n.test=function(){return t},n.install=function(n){var r=0,o=new t(n),i=e.document.createTextNode("");return o.observe(i,{characterData:!0}),function(){i.data=r=++r%2}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],16:[function(e,t,n){(function(e){"use strict";n.test=function(){return"document"in e&&"onreadystatechange"in e.document.createElement("script")},n.install=function(t){return function(){var n=e.document.createElement("script");return n.onreadystatechange=function(){t(),n.onreadystatechange=null,n.parentNode.removeChild(n),n=null},e.document.documentElement.appendChild(n),t}}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],17:[function(e,t,n){"use strict";n.test=function(){return!0},n.install=function(e){return function(){setTimeout(e,0)}}},{}]},{},[4])(4)}()}()}])})},function(e,t,n){"use strict";function r(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),o=new Uint8Array(r),i=0;i<t.length;i++)o[i]=t.charCodeAt(i);var s=new DataView(r);return new Blob([s.buffer],{type:n})}function o(e){if(!(e instanceof Response))throw new Error("Expecting response to be instance of Response");for(var t=[],n=e.headers.keys(),r=0;r<n.length;r++){var o=n[r];t[o]=e.headers.get(o)}return new Promise(function(n,r){var o=new FileReader;e.blob().then(function(e){return o.readAsDataURL(e)}),o.onerror=r,o.onloadend=function(){n(JSON.stringify({type:e.type,url:e.url,useFinalURL:e.useFinalURL,status:e.status,ok:e.ok,statusText:e.statusText,headers:t,__body:o.result}))}})}function i(e){var t;if("string"==typeof e)t=JSON.parse(e);else{if("object"!=typeof e)throw new Error("Expecting serialised response to be a string or object");t=e}return new Response(r(t.__body))}var s,s;o.deserialise=i,o.deserialize=i,void 0!==(s=function(){return o}.call(t,n,t,e))&&(e.exports=s),void 0!==(s=function(){return o}.call(t,n,t,e))&&(e.exports=s)},function(e,t,n){"use strict";function r(){var e,t;return{promise:new Promise(function(n,r){e=n,t=r}),resolve:e,reject:t}}var o;void 0!==(o=function(){return r}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){"use strict";function r(e){var t="",n=Math.floor(.001*(Date.now()-a));return n===i?o++:(o=0,i=n),t+=s(u.lookup,c),t+=s(u.lookup,e),o>0&&(t+=s(u.lookup,o)),t+=s(u.lookup,n)}var o,i,s=n(1),u=n(0),a=1459707606518,c=6;e.exports=r},function(e,t,n){"use strict";function r(e){var t=o.shuffled();return{version:15&t.indexOf(e.substr(0,1)),worker:15&t.indexOf(e.substr(1,1))}}var o=n(0);e.exports=r},function(e,t,n){"use strict";function r(t){return u.seed(t),e.exports}function o(t){return l=t,e.exports}function i(e){return void 0!==e&&u.characters(e),u.shuffled()}function s(){return c(l)}var u=n(0),a=(n(1),n(8)),c=n(7),f=n(10),l=n(13)||0;e.exports=s,e.exports.generate=s,e.exports.seed=r,e.exports.worker=o,e.exports.characters=i,e.exports.decode=a,e.exports.isValid=f},function(e,t,n){"use strict";function r(e){if(!e||"string"!=typeof e||e.length<6)return!1;for(var t=o.characters(),n=e.length,r=0;r<n;r++)if(-1===t.indexOf(e[r]))return!1;return!0}var o=n(0);e.exports=r},function(e,t,n){"use strict";function r(){if(!o||!o.getRandomValues)return 48&Math.floor(256*Math.random());var e=new Uint8Array(1);return o.getRandomValues(e),48&e[0]}var o="object"==typeof window&&(window.crypto||window.msCrypto);e.exports=r},function(e,t,n){"use strict";function r(){return(i=(9301*i+49297)%233280)/233280}function o(e){i=e}var i=1;e.exports={nextValue:r,seed:o}},function(e,t,n){"use strict";e.exports=0},,function(e,t,n){"use strict";e.exports=function(){var e,t;return{promise:new Promise(function(n,r){e=n,t=r}),resolve:e,reject:t}}},function(e,t,n){"use strict";function r(e,t){var n=t||self,r=n.navigator;if(!("serviceWorker"in r))return Promise.reject(new Error("Service Workers unsupported"));var o=r.serviceWorker.controller;return Promise.resolve().then(function(){return o||(e?void 0:r.serviceWorker.ready)}).then(function(t){if(t)o=t;else{if(!t&&e)return r.serviceWorker.register(e.url,e).then(function(t){e.forceUpdate&&t.update()});if(!t&&!e)throw new Error("no active service worker or configuration passed to install one")}}).then(function(){return o})}var o;void 0!==(o=function(){return r}.call(t,n,t,e))&&(e.exports=o)},function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function o(e){return function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];if(y)return h.promise.then(function(){return e.apply(void 0,n)});throw new Error("initialise first with fetchSync.init()")}}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=n(3),a=n(2),c=n(15),f=n(16),l=n(4),p=n(5),h=c(),d=[],v=null,y=!1,w=!0,m={_base:{id:null,name:null,createdOn:null,syncedOn:null,request:null,response:null,cancelled:!1},_create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return s({},m._base,e,c())},createFromUserOptions:function(e){return m._create({id:e.name||a.generate(),name:e.name,createdOn:Date.now(),request:e.request})},hydrate:function(e){var t=m._create(e);return t.response&&(t.response=p.deserialise(t.response),t.resolve()),t},makePublicApi:function(e){return Object.assign(e.promise,{name:e.name,id:e.id,createdOn:e.createdOn,syncedOn:e.syncedOn,cancel:function(){return e.cancelled||e.response?Promise.reject(new Error("already cancelled or complete")):(e.cancelled=!0,v.send("CANCEL_SYNC",e.id))}})}},b=function(e){return u.client(e,{SYNC_RESULT:function(e){var t=e.id,n=e.syncedOn,r=e.response,o=d.find(function(e){return e.id===t});if(o){var i=p.deserialise(r);o.resolve(i),o.name&&(o.response=i,o.syncedOn=n)}}})},g=function(e,t,n){var r=arguments;if(!y)throw new Error("initialise first with fetchSync.init()");if(1===arguments.length?(t=e,e=null):function(){return 2===r.length&&("string"==typeof r[0]||r[0]instanceof Request)&&"object"===i(r[1])&&!(r[1]instanceof Request)}()&&(n=t,t=e,e=null),!("string"==typeof t||t instanceof Request))throw new Error("expecting request to be a string or Request");if(n&&"object"!==(void 0===n?"undefined":i(n)))throw new Error("expecting options to be an object");if(!w)return fetch(t,n);var o=d.find(function(t){return t.id===e});if(o){var s=new Error("sync operation already exists with name '"+e+"'");return Promise.reject(s)}return o=m.createFromUserOptions({name:e,request:t,options:n}),d.push(o),h.promise.then(function(){return l(new Request(t,n))}).then(function(e){o.request=e}).then(function(){return v.send("REGISTER_SYNC",o)}),m.makePublicApi(o)};t.default=g,g.init=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(y)throw new Error("fetchSync.init() called multiple times");return y=!0,"serviceWorker"in navigator&&"SyncManager"in window?f(e).then(b).then(function(e){v=e}).then(function(){return v.send("GET_SYNCS")}).then(function(e){var t;return(t=d).push.apply(t,r((e||[]).map(m.hydrate)))}).then(function(){h.resolve()}):(w=!1,Promise.reject(new Error("environment not supported")))},g.get=o(function(e){var t=d.find(function(t){return t.name===e});return t?m.makePublicApi(t):Promise.reject(new Error("not found"))}),g.getAll=o(function(){return d.map(m.makePublicApi)}),g.cancel=o(function(e){var t=d.find(function(t){return t.name===e});return t?m.makePublicApi(t).cancel():Promise.reject(new Error("not found"))}),g.cancelAll=o(function(){return v.send("CANCEL_ALL_SYNCS").then(function(){d=[]})}),e.exports=t.default}])});